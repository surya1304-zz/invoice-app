<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="./assets/favicon-32x32.png"
        />

        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
            integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
            crossorigin="anonymous"
        />
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link
            href="https://fonts.googleapis.com/css2?family=Spartan:wght@500;700&display=swap"
            rel="stylesheet"
        />

        <link rel="stylesheet" href="../css/style.css" />

        <title>Invoice app</title>
    </head>

    <body>
        <div class="overlay"></div>
        <sidebar>
            <div class="side_bar">
                <div class="top">
                    <div class="figure"></div>
                </div>
                <div class="bottom">
                    <button class="theme">
                        <img
                            id="theme"
                            src="./assets/icon-moon.svg"
                            alt=""
                            srcset=""
                        />
                    </button>
                    <img
                        class="avatar"
                        src="./assets/image-avatar.jpg"
                        alt=""
                    />
                </div>
            </div>
        </sidebar>

        <div class="side_invoice">
            <form class="new" method="POST" onsubmit="return formValidate()">
                <div class="new__invoice">
                    Edit <span class="hash">#</span>
                    <h1 class="id1">ABCD</h1>
                </div>
                <h5 class="new__details">Bill From</h5>
                <div class="new__bill-from">
                    <label for="fromStreetAddress" class="label"
                        >Street Address</label
                    >
                    <input
                        required
                        name="fromStreetAddress"
                        class="invoice__input"
                        type="text"
                        id="fromStreetAddress"
                    />
                    <div class="new__bill-address">
                        <div class="city">
                            <label for="fromCity" class="label">City</label>
                            <input
                                required
                                name="fromCity"
                                class="invoice__input"
                                type="text"
                                id="fromCity"
                            />
                        </div>
                        <div class="postCode">
                            <label for="fromPostCode" class="label"
                                >Post Code</label
                            >
                            <input
                                required
                                name="fromPostCode"
                                class="invoice__input"
                                type="text"
                                id="fromPostCode"
                            />
                        </div>
                        <div class="country">
                            <label for="fromCountry" class="label"
                                >Country</label
                            >
                            <input
                                required
                                name="fromCountry"
                                class="invoice__input"
                                type="text"
                                id="fromCountry"
                            />
                        </div>
                    </div>
                </div>
                <h5 class="new__details">Bill To</h5>
                <div class="new__bill-to">
                    <label for="toClientName" class="label"
                        >Client's name</label
                    >
                    <input
                        required
                        name="toClientName"
                        class="invoice__input"
                        type="text"
                        id="toClientName"
                    />
                    <label for="toClientEmail" class="label"
                        >Client's Email</label
                    >
                    <input
                        required
                        name="toClientEmail"
                        class="invoice__input"
                        type="email"
                        id="toClientEmail"
                        placeholder="e.g. email@example.com"
                    />
                    <label for="toStreetAddress" class="label"
                        >Street Address</label
                    >
                    <input
                        required
                        name="toStreetAddress"
                        type="text"
                        id="toStreetAddress"
                        class="invoice__input"
                    />
                    <div class="new__bill-address">
                        <div class="city">
                            <label for="toCity" class="label">City</label>
                            <input
                                required
                                name="toCity"
                                type="text"
                                class="invoice__input"
                                id="toCity"
                            />
                        </div>
                        <div class="postCode">
                            <label for="toPostCode" class="label"
                                >Post Code</label
                            >
                            <input
                                required
                                name="toPostCode"
                                type="text"
                                class="invoice__input"
                                id="toPostCode"
                            />
                        </div>
                        <div class="country">
                            <label for="toCountry" class="label">Country</label>
                            <input
                                required
                                name="toCountry"
                                type="text"
                                class="invoice__input"
                                id="toCountry"
                            />
                        </div>
                    </div>
                </div>
                <div class="new__date-payment">
                    <div class="new__date">
                        <label for="invoiceDate" class="label"
                            >Invoice Date</label
                        >
                        <div class="date-picker">
                            <div class="issue-date">
                                <div class="selected-date"></div>
                                <img src="./assets/icon-calendar.svg" alt="" />
                            </div>
                            <div class="dates">
                                <div class="month">
                                    <div class="arrows prev-mth">
                                        <img
                                            src="../starter-code/assets/icon-arrow-left.svg"
                                            alt=""
                                        />
                                    </div>
                                    <div class="mth"></div>
                                    <div class="arrows next-mth">
                                        <img
                                            src="../starter-code/assets/icon-arrow-right.svg"
                                            alt=""
                                        />
                                    </div>
                                </div>
                                <div class="days"></div>
                            </div>
                        </div>
                    </div>
                    <div class="new__payment-terms">
                        <div class="new__payment-dropdown">
                            <label for="dropdown" class="label"
                                >Payment Terms</label
                            >
                            <div data-value="30" class="selected-item">
                                Net 30 Days
                            </div>
                            <div id="dropdown">
                                <ul>
                                    <li value="1">Net 1 Day</li>
                                    <li value="7">Net 7 Days</li>
                                    <li value="14">Net 14 Days</li>
                                    <li value="30" class="selected">
                                        Net 30 Days
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <label for="projectDescription" class="label"
                    >Project Description</label
                >
                <input
                    required
                    name="projectDescription"
                    type="text"
                    class="invoice__input"
                    id="projectDescription"
                    placeholder="e.g. Graphic Design Service"
                />
                <h2 class="invoice__itemList">Item List</h2>
                <div class="invoice__items">
                    <div class="item">
                        <label for="itemName" class="label">Item Name</label>
                        <label for="quantity" class="label">Qty.</label>
                        <label for="price" class="label">Price</label>
                        <label for="total" class="label">Total</label>
                        <div></div>
                    </div>
                </div>
                <button id="addItem" class="button5">+ Add New Item</button>
                <div class="editButtons">
                    <button id="discard" class="button3">Discard</button>
                    <button id="saveandsend" type="submit" class="button2">
                        Save & Send
                    </button>
                </div>
            </form>
        </div>

        <div class="invoices">
            <a class="link" href="./js_components.html">Go Back</a>
            <div class="invoices__header">
                <div class="invoices__status">
                    <p class="inline_heading">Status</p>
                    <p id="status" class="big status pending">pending</p>
                </div>
                <div class="invoices__modifiers">
                    <button id="edit" class="button3">Edit</button>
                    <button id="delete" class="delete button4">Delete</button>
                    <button id="markAsPaid" class="button2">
                        Mark As Paid
                    </button>
                </div>
            </div>
            <div class="invoices__body">
                <div class="invoices__content">
                    <div class="invoices__id-desc">
                        <p class="invoices__id">AB123</p>
                        <p class="invoices__des">Hello World</p>
                    </div>
                    <div class="fromAddress">
                        <p class="fromStreetAddress">123</p>
                        <p class="fromCity">1234</p>
                        <p class="fromPostCode">12345</p>
                        <p class="fromCountry">123456</p>
                    </div>
                </div>
                <div class="clientDetails">
                    <div class="date_due">
                        <div class="clientDate">
                            <p class="heading">Invoice Date</p>
                            <p id="invoices__date" class="bold-text">
                                15 May 2021
                            </p>
                        </div>
                        <div class="clientDue">
                            <p class="heading">Payment Due</p>
                            <p id="invoices__due" class="bold-text">
                                21 May 2021
                            </p>
                        </div>
                    </div>
                    <div class="toAddress">
                        <p class="heading">Bill to</p>
                        <p id="clientName" class="bold-text">Surya Sai</p>
                        <p class="toStreetAddress">123</p>
                        <p class="toCity">1234</p>
                        <p class="toPostCode">12345</p>
                        <p class="toCountry">123456</p>
                    </div>
                    <div class="clientEmail">
                        <p class="heading">Sent to</p>
                        <p id="client__email" class="bold-text">
                            suryasai678@gmail.com
                        </p>
                    </div>
                </div>
                <div class="InvoiceDue">
                    <div class="invoicesItemsList">
                        <div class="lt">
                            <p class="heading">Item Name</p>
                            <p class="Center heading">QTY.</p>
                            <p class="Right heading">Price</p>
                            <p class="Right heading">Total</p>
                        </div>
                    </div>
                    <div class="listTotal">
                        <p class="Amount">Amount Due</p>
                        <p class="TA">£ 156</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="conat">
            <div class="deletepopup">
                <h1>Confirm Deletion</h1>
                <p id="deleteid"></p>
                <div class="popupButtons">
                    <button id="finalCancel" class="button3">Cancel</button>
                    <button id="finalDelete" class="button4 delete">
                        Delete
                    </button>
                </div>
            </div>
        </div>
        <script src="../JS/adding_invoice.js"></script>
        <script src="../JS/invoice_fetch.js"></script>
        <script src="../JS/theme.js"></script>
        <script src="../JS/date-picker.js"></script>
        <script src="../JS/payment_dropdown.js"></script>
        <script src="../JS/edit_form_handler.js"></script>
        <script>
            let deleteId = document.getElementById("deleteid");
            deleteId.innerHTML = `Are you sure you want to delete invoice #${sub}? This action cannot be undone.`;
            let deleteButton = document.getElementById("delete");
            let overlay = document.querySelector(".overlay");
            let deletePopup = document.querySelector(".conat");
            let finalCancel = document.querySelector("#finalCancel");
            let edit = document.querySelector("#edit");
            let edit_invoice = document.querySelector(".side_invoice");

            deleteButton.addEventListener("click", (e) => {
                overlay.style.display = "block";
                deletePopup.classList.add("show");
            });

            edit.addEventListener("click", (e) => {
                overlay.style.display = "block";
                edit_invoice.classList.add("show");
            });

            finalCancel.addEventListener("click", (e) => {
                overlay.style.display = "none";
                deletePopup.classList.remove("show");
            });

            let finalDelete = document.querySelector("#finalDelete");

            finalDelete.addEventListener("click", (e) => {
                e.preventDefault();

                const DELETE_OPTIONS = {
                    method: "DELETE",
                    mode: "cors",
                };

                fetch(`http://localhost:3000/${sub}`, DELETE_OPTIONS)
                    .then((res) => res.json())
                    .then((data) => {
                        console.log(data);
                        if (data.ok === 1) {
                            localStorage.removeItem("jsonData");
                            window.location =
                                "/starter-code/js_components.html";
                        }
                    });
            });

            const discard = document.getElementById("discard");

            discard.addEventListener("click", (e) => {
                e.preventDefault();
                edit_invoice.classList.remove("show");
                overlay.style.display = "none";
            });
        </script>
        <script>
            let invoiceID = document.querySelector(".new__invoice");
            console.log(invoiceID);
            invoiceID.children[1].innerHTML = sub;

            const Hello = () => {
                let quantities = document.querySelectorAll(".quantity");
                let totals = document.querySelectorAll(".total");
                let prices = document.querySelectorAll(".price");
                for (let i = 0; i < quantities.length; i++) {
                    let yt = quantities[i].value * prices[i].value;
                    totals[i].innerHTML = yt;
                    totals[i].dataset.value = yt;
                }
            };

            const markaspaid = document.getElementById("markAsPaid");

            markaspaid.addEventListener("click", (e) => {
                e.preventDefault();

                const PUT_OPTIONS = {
                    method: "PUT",
                    mode: "cors",
                    headers: {
                        "Content-Type": "application/json",
                    },
                };

                fetch(`http://localhost:3000/${sub}`, PUT_OPTIONS)
                    .then((res) => res.json())
                    .then((data) => {
                        window.location.reload();
                    });
            });
        </script>
    </body>
</html>
